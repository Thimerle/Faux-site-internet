<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mon compte</title>
  <style>body{font-family:Arial,Helvetica,sans-serif;padding:24px;background:#f7f7fb} .card{max-width:520px;margin:40px auto;padding:18px;border-radius:10px;background:#fff;box-shadow:0 8px 30px rgba(0,0,0,.06)} button{padding:8px 12px;border-radius:8px;border:none;background:#0070f3;color:#fff} a{color:#0070f3}</style>
</head>
<body>
  <div class="card">
    <h2>Mon compte</h2>
    <div id="info">Chargement...</div>
    <div style="margin-top:12px"><button id="logout">Se d√©connecter</button> <a href="index.html" style="margin-left:12px">Retour boutique</a></div>
  </div>
  <script src="auth.js"></script>
  <script>
    const info = document.getElementById('info');
    const user = currentUser();
    const token = localStorage.getItem('fs_token');
    if(!user && !token){ window.location.href='login.html'; }
    else{
      // try to validate token with /api/me
      (async ()=>{
        try{
          const r = await fetch('/api/me',{headers:{'Authorization': token?`Bearer ${token}`:''}});
          if(r.ok){ const j = await r.json(); info.innerHTML = `<div><strong>Utilisateur :</strong> ${j.user.username}</div><div class=\"muted\"><strong>Email :</strong> ${j.user.email}</div>`; }
          else if(user){ info.innerHTML = `<div><strong>Utilisateur :</strong> ${user.username}</div><div class=\"muted\"><strong>Email :</strong> ${user.email}</div>`; }
          else { window.location.href='login.html'; }
        }catch(e){ if(user) info.innerHTML = `<div><strong>Utilisateur :</strong> ${user.username}</div><div class=\"muted\"><strong>Email :</strong> ${user.email}</div>`; }
      })();
    }
    document.getElementById('logout').addEventListener('click', ()=>{logout(); window.location.href='index.html'});
  </script>
</body>
</html>
